<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Accomplishment Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* General Styles and Layout - PROFESSIONAL ENHANCEMENT */
        body {
            font-family: 'Lato', Arial, sans-serif;
            background-color: #eef1f5;
            color: #1a202c;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 30px;
        }

        /* Controls styling (for screen display only) - PROFESSIONAL ENHANCEMENT */
        .controls {
            background-color: #ffffff;
            padding: 25px 30px;
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
            margin-bottom: 40px;
            width: 100%;
            max-width: 900px;
            box-sizing: border-box;
            border-top: 5px solid #0056b3;
        }
        .controls h2 {
            margin-top: 0;
            text-align: center;
            color: #0056b3;
            font-weight: 900;
            font-size: 1.8rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        .control-group label {
            margin-bottom: 7px;
            font-weight: 700;
            color: #4a5568;
            font-size: 0.95rem;
        }
        .control-group input[type="text"],
        .control-group input[type="date"] {
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: #f7fafc;
        }
        .control-group input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
            background-color: #ffffff;
        }
        .section-header {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2d3748;
            border-bottom: 2px solid #a0aec0;
            padding: 8px 0;
            margin: 20px 0 10px;
            grid-column: 1 / -1;
            text-transform: uppercase;
        }
        .button-container {
            text-align: center;
            margin-top: 30px;
        }
        .button-container button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            margin: 0 10px;
            transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-decoration: none;
        }
        .button-container button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button-container button#generate-btn {
            background-color: #007bff;
        }
        .button-container button#generate-btn:hover {
            background-color: #0056b3;
        }
        .button-container button.print-btn {
            background-color: #28a745;
        }
        .button-container button.print-btn:hover {
            background-color: #1e7e34;
        }
        .button-container button.clear-btn {
            background-color: #dc3545;
        }
        .button-container button.clear-btn:hover {
            background-color: #c82333;
        }
        /* New Credit Style */
        #credit-obet {
            text-align: center;
            margin-top: 15px;
            font-size: 0.85rem;
            color: #718096; /* Subtle gray color */
            font-weight: 400;
        }
        #credit-obet span.icon {
            font-size: 1em; /* Ensure the icon size matches the text */
            margin-right: 5px;
            color: #0056b3; /* Color the icon blue for emphasis */
        }
        
        /* Toast notification style */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
            max-width: 300px;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.success {
            background-color: #28a745;
        }
        .toast.info {
            background-color: #17a2b8;
        }

        /* Update Notification Modal */
        .update-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .update-modal.show {
            opacity: 1;
            visibility: visible;
        }
        .update-card {
            background: white;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            transform: scale(0.8);
            transition: transform 0.3s;
        }
        .update-modal.show .update-card {
            transform: scale(1);
        }
        .update-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        .update-header h2 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 900;
        }
        .update-header .version-badge {
            display: inline-block;
            background-color: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.9rem;
            font-weight: 700;
        }
        .update-header .update-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            opacity: 0.8;
        }
        .update-body {
            padding: 30px;
        }
        .update-body h3 {
            color: #2d3748;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }
        .update-body h3 span {
            margin-right: 10px;
            color: #007bff;
        }
        .update-list {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }
        .update-list li {
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: flex-start;
        }
        .update-list li:last-child {
            border-bottom: none;
        }
        .update-list li::before {
            content: "âœ“";
            color: #28a745;
            font-weight: bold;
            margin-right: 15px;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        .update-footer {
            padding: 20px 30px;
            background-color: #f8f9fa;
            text-align: center;
            border-top: 1px solid #e2e8f0;
        }
        .update-footer button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .update-footer button:hover {
            background-color: #0056b3;
        }
        .update-footer button:active {
            transform: translateY(1px);
        }
        .dont-show-again {
            margin-top: 15px;
        }
        .dont-show-again label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.9rem;
            color: #4a5568;
        }
        .dont-show-again input[type="checkbox"] {
            margin-right: 8px;
        }

        /* Report container styling (A4-like paper) - PROFESSIONAL ENHANCEMENT */
        .report-container {
            background-color: white;
            width: 100%;
            max-width: 900px;
            padding: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            box-sizing: border-box;
            min-height: 1000px;
            border: 1px solid #ddd;
        }

        /* Header section with logo and department - PROFESSIONAL ENHANCEMENT */
        .report-header-top {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            flex-direction: column;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }
        .report-header-top .logo {
            height: 80px;
            margin-bottom: 5px;
        }
        .report-header-top .department {
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
            color: #4a5568;
            text-transform: uppercase;
        }

        .report-header {
            text-align: center;
            border-bottom: 2px solid #1a202c;
            padding-bottom: 15px;
            margin-bottom: 30px;
            margin-top: 10px;
        }
        .report-header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 900;
            color: #1a202c;
            text-transform: uppercase;
        }
        .report-header p {
            margin: 5px 0 0;
            font-size: 1rem;
            font-weight: 700;
            color: #4a5568;
        }

        /* Employee details - PROFESSIONAL ENHANCEMENT */
        .employee-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
            padding: 10px 0;
            border: 1px solid #e2e8f0;
            border-left: 0;
            border-right: 0;
        }
        .detail-item {
            display: flex;
            align-items: center;
            font-size: 15px;
        }
        .detail-item span {
            font-weight: 700;
            margin-right: 15px;
            min-width: 80px;
            color: #2d3748;
        }
        .detail-item p {
            margin: 0;
            border-bottom: 1px dashed #a0aec0;
            flex-grow: 1;
            padding: 2px 5px;
            text-transform: uppercase;
            font-weight: 400;
        }

        /* Table styling - PROFESSIONAL ENHANCEMENT */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            font-size: 13px;
        }
        th, td {
            border: 1px solid #a0aec0;
            padding: 12px 10px;
            text-align: left;
        }
        th {
            background-color: #f7fbfc;
            font-weight: 900;
            text-align: center;
            color: #2d3748;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 14px;
        }
        td:first-child {
            text-align: center;
            width: 130px;
            font-weight: 700;
            color: #4a5568;
            background-color: #fcfcfc;
        }

        /* --- CSS for editable cells --- */
        td[contenteditable="true"] {
            background-color: #fff;
            cursor: text;
        }
        td[contenteditable="true"]:focus {
            background-color: #f0f8ff;
            outline: 2px solid #007bff;
        }
        /* Re-apply light yellow only to default weekday entries for visual cue */
        #report-body tr td:nth-child(2):not(:contains("SUNDAY")):not(:contains("SATURDAY")):not(:empty) {
            background-color: #fefef0;
        }

        /* Footer/Signature section - PROFESSIONAL ENHANCEMENT */
        .report-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 100px;
            padding: 0 40px;
        }
        .signature-block {
            text-align: center;
            width: 45%;
        }
        .signature-block span {
            font-size: 13px;
            font-style: normal;
            font-weight: 400;
            color: #4a5568;
        }
        .signature-block .name {
            font-weight: 900;
            margin-top: 40px;
            padding-bottom: 5px;
            border-bottom: 2px solid #1a202c;
            text-transform: uppercase;
            font-size: 1.1rem;
        }
        .signature-block .title {
            font-size: 11px;
            text-transform: uppercase;
            color: #4a5568;
            margin-top: 5px;
            font-weight: 700;
        }

        /* --- PRINT STYLES (Adjusted for new design) --- */
        @page {
            size: letter;
            margin: 0.75in 1in;
        }
        @media print {
            body {
                background-color: white;
                padding: 0;
                margin: 0;
                font-size: 10pt;
                font-family: 'Lato', serif;
            }
            
            .controls, #credit-obet, .toast, .update-modal { /* Hide controls, credit line, toast AND update modal when printing */
                display: none;
            }

            .report-container {
                box-shadow: none;
                margin: 0 auto;
                padding: 0;
                width: 100%;
                max-width: 100%;
                min-height: auto;
                page-break-inside: avoid;
            }

            /* Remove all background colors in print */
            td[contenteditable="true"], 
            #report-body tr td:nth-child(2):not(:contains("SUNDAY")):not(:contains("SATURDAY")):not(:empty),
            th {
                background-color: #fff !important;
                box-shadow: none !important;
                outline: none !important; -webkit-print-color-adjust: exact;
            }

            .report-header-top .logo {
                height: 60px;
            }
            .report-header h1 {
                font-size: 18pt;
            }
            .report-header p {
                font-size: 12pt;
            }
            
            table {
                font-size: 9pt;
            }
            th, td {
                padding: 6px;
                border-color: #333;
            }

            .report-footer {
                margin-top: 50px;
                padding: 0;
            }
            .signature-block .name {
                margin-top: 30px;
            }
        }
    </style>
</head>
<body>

    <!-- Update Notification Modal -->
    <div id="updateModal" class="update-modal">
        <div class="update-card">
            <div class="update-header">
                <span class="update-icon">ðŸš€</span>
                <h2>What's New!</h2>
                <div class="version-badge">Version 1.2.0</div>
            </div>
            <div class="update-body">
                <h3><span>âœ¨</span>Latest Updates</h3>
                <ul class="update-list">
                    <li><strong>Data Persistence:</strong> Your form data is now automatically saved and restored when you return</li>
                    <li><strong>Smart Notifications:</strong> Get real-time feedback with toast notifications for all actions</li>
                    <li><strong>Clear Data Option:</strong> New button to reset all saved data when needed</li>
                    <li><strong>Enhanced UI:</strong> Improved visual design with better color schemes and transitions</li>
                    <li><strong>Bug Fixes:</strong> Resolved timezone issues and improved date handling</li>
                </ul>
                <h3><span>ðŸ’¡</span>Tips</h3>
                <ul class="update-list">
                    <li>All your data is saved automatically as you type</li>
                    <li>Click on any task cell to edit it directly</li>
                    <li>Empty cells will restore to default values automatically</li>
                </ul>
            </div>
            <div class="update-footer">
                <button id="closeUpdateModal">Get Started</button>
                <div class="dont-show-again">
                    <label>
                        <input type="checkbox" id="dontShowAgain">
                        Don't show this message again
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <h2>Report Generator Controls <span style="color: #4a5568;">| DATA INPUT</span></h2>
        <div class="control-grid">
            <div class="section-header">Employee & Period Details</div>
            <div class="control-group">
                <label for="employee-name">Employee Name:</label>
                <input type="text" id="employee-name" value="JEREMY C. BENEDICTO">
            </div>
            <div class="control-group">
                <label for="employee-position">Position:</label>
                <input type="text" id="employee-position" value="JOB ORDER">
            </div>
            <div class="control-group">
                <label for="department-name">Department Name:</label>
                <input type="text" id="department-name" value="HUMAN RESOURCE MANAGEMENT OFFICE">
            </div>
            <div class="control-group">
                <label for="start-date">Start Date:</label>
                <input type="date" id="start-date" value="2025-10-01">
            </div>
            <div class="control-group">
                <label for="end-date">End Date:</label>
                <input type="date" id="end-date" value="2025-10-15">
            </div>
            <div class="control-group" style="grid-column: 1 / -1;">
                <label for="default-task">Default Weekday Task:</label>
                <input type="text" id="default-task" value="Continued system development for Municipal Digital Billboard">
            </div>

            <div class="section-header">Certifier Details (Head of Department)</div>
            <div class="control-group">
                <label for="certifier-name">Certifier Name:</label>
                <input type="text" id="certifier-name" value="JENNELYN D. DALACAT">
            </div>
            <div class="control-group">
                <label for="certifier-title">Certifier Position/Title:</label>
                <input type="text" id="certifier-title" value="Head of HRMO">
            </div>
        </div>
        
        <div class="button-container">
            <button id="generate-btn">Generate Report</button>
            <button id="print-btn" class="print-btn">Print Report ðŸ“„</button>
            <button id="clear-btn" class="clear-btn">Clear Saved Data</button>
        </div>

        <div id="credit-obet"><span class="icon">ðŸ’»</span>Jeremy v1.2.0</div>
    </div>

    <div class="report-container">
        <div class="report-header-top">
            <img src="logoo.png" alt="Official Seal" class="logo">
            <div class="department" id="display-department">HRMO</div>
        </div>

        <header class="report-header">
            <h1>ACCOMPLISHMENT REPORT</h1>
            <p id="report-period">AUG 1-15, 2025</p>
        </header>

        <section class="employee-details">
            <div class="detail-item">
                <span>Name:</span>
                <p id="display-name">JEREMY C. BENEDICTO</p>
            </div>
            <div class="detail-item">
                <span>Position:</span>
                <p id="display-position">JOB ORDER</p>
            </div>
        </section>

        <table>
            <thead>
                <tr>
                    <th>DATE</th>
                    <th>ACCOMPLISHMENT DETAILS</th>
                </tr>
            </thead>
            <tbody id="report-body">
                </tbody>
        </table>

        <footer class="report-footer">
            <div class="signature-block">
                <span>Submitted by:</span>
                <div class="name" id="footer-name">JEREMY C. BENEDICTO</div>
                <div class="title" id="footer-position">Employee</div>
            </div>
            <div class="signature-block">
                <span>Certified Correct:</span>
                <div class="name" id="certifier-name-display">JENNELYN D. DALACAT</div>
                <div class="title" id="certifier-title-display">Head of HRMO</div>
            </div>
        </footer>
    </div>

    <!-- Toast notification element -->
    <div id="toast" class="toast"></div>

    <script>
        // Get references to all interactive elements
        const generateBtn = document.getElementById('generate-btn');
        const printBtn = document.getElementById('print-btn');
        const clearBtn = document.getElementById('clear-btn');
        const allInputs = document.querySelectorAll('.controls input');
        const reportBody = document.getElementById('report-body');
        const toast = document.getElementById('toast');
        const updateModal = document.getElementById('updateModal');
        const closeUpdateModalBtn = document.getElementById('closeUpdateModal');
        const dontShowAgainCheckbox = document.getElementById('dontShowAgain');

        // Storage keys for localStorage
        const STORAGE_KEY = 'accomplishment_report_data';
        const UPDATE_MODAL_KEY = 'hide_update_modal_v1_2_0';
        const LAST_SEEN_VERSION = 'last_seen_version';

        /**
         * Shows the update notification modal
         */
        function showUpdateModal() {
            // Check if user has chosen to hide this update
            const hideModal = localStorage.getItem(UPDATE_MODAL_KEY);
            const lastSeenVersion = localStorage.getItem(LAST_SEEN_VERSION);
            
            // Only show if not hidden or if version has changed
            if (hideModal !== 'true' || lastSeenVersion !== '1.2.0') {
                setTimeout(() => {
                    updateModal.classList.add('show');
                }, 500); // Small delay to ensure page is loaded
            }
        }

        /**
         * Hides the update notification modal
         */
        function hideUpdateModal() {
            updateModal.classList.remove('show');
            
            // Save user preference if checkbox is checked
            if (dontShowAgainCheckbox.checked) {
                localStorage.setItem(UPDATE_MODAL_KEY, 'true');
                localStorage.setItem(LAST_SEEN_VERSION, '1.2.0');
            }
        }

        /**
         * Shows a toast notification
         * @param {string} message - The message to display
         * @param {string} type - The type of toast (success, info, error)
         */
        function showToast(message, type = 'info') {
            toast.textContent = message;
            toast.className = 'toast show ' + type;
            
            setTimeout(() => {
                toast.className = toast.className.replace('show', '');
            }, 3000);
        }

        /**
         * Saves all form data to localStorage
         */
        function saveFormData() {
            const formData = {};
            allInputs.forEach(input => {
                formData[input.id] = input.value;
            });
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
        }

        /**
         * Loads form data from localStorage
         */
        function loadFormData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const formData = JSON.parse(savedData);
                allInputs.forEach(input => {
                    if (formData[input.id]) {
                        input.value = formData[input.id];
                    }
                });
                return true;
            }
            return false;
        }

        /**
         * Clears all saved data from localStorage
         */
        function clearSavedData() {
            localStorage.removeItem(STORAGE_KEY);
            showToast('Saved data cleared', 'info');
        }

        /**
         * Formats a Date object into MM/DD/YYYY string.
         * @param {Date} date - The date object.
         * @returns {string} - Formatted date string.
         */
        function formatDate(date) {
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${month}/${day}/${year}`;
        }

        /**
         * Formats the report period for the header (e.g., AUG 1-15, 2025).
         * @param {Date} start - The start date.
         * @param {Date} end - The end date.
         * @returns {string} - Formatted period string.
         */
        function formatPeriod(start, end) {
            const startMonth = start.toLocaleString('default', { month: 'short' }).toUpperCase();
            const endMonth = end.toLocaleString('default', { month: 'short' }).toUpperCase();
            const startDay = start.getDate();
            const endDay = end.getDate();
            const year = start.getFullYear();

            if (startMonth === endMonth) {
                return `${startMonth} ${startDay}-${endDay}, ${year}`;
            } else {
                return `${startMonth} ${startDay} - ${endMonth} ${endDay}, ${year}`;
            }
        }

        /**
         * Generates the accomplishment report table rows based on input controls.
         */
        function generateReport() {
            // 1. Get Control Values
            const employeeName = document.getElementById('employee-name').value;
            const employeePosition = document.getElementById('employee-position').value;
            const departmentName = document.getElementById('department-name').value;
            const startDateInput = document.getElementById('start-date').value;
            const endDateInput = document.getElementById('end-date').value;
            const defaultTask = document.getElementById('default-task').value;
            
            // New Certifier Details
            const certifierName = document.getElementById('certifier-name').value;
            const certifierTitle = document.getElementById('certifier-title').value;


            let startDate = new Date(startDateInput);
            let endDate = new Date(endDateInput);
            
            // Adjust dates for local timezone to ensure the date matches the input value's day.
            if (startDateInput) startDate.setMinutes(startDate.getMinutes() + startDate.getTimezoneOffset());
            if (endDateInput) endDate.setMinutes(endDate.getMinutes() + endDate.getTimezoneOffset());
            
            // Input Validation
            if (!startDateInput || !endDateInput || isNaN(startDate) || isNaN(endDate) || startDate > endDate) {
                reportBody.innerHTML = '<tr><td colspan="2" style="text-align:center; color:red; font-weight:bold;">Please select a valid date range.</td></tr>';
                return;
            }

            // 2. Update Header/Footer Display
            document.getElementById('display-name').textContent = employeeName.toUpperCase();
            document.getElementById('display-position').textContent = employeePosition.toUpperCase();
            document.getElementById('display-department').textContent = departmentName.toUpperCase();
            
            // Submitted By
            document.getElementById('footer-name').textContent = employeeName.toUpperCase();
            document.getElementById('footer-position').textContent = employeePosition.toUpperCase();

            // Certified Correct
            document.getElementById('certifier-name-display').textContent = certifierName.toUpperCase();
            document.getElementById('certifier-title-display').textContent = certifierTitle.toUpperCase();

            document.getElementById('report-period').textContent = formatPeriod(startDate, endDate);
            
            // 3. Generate Table Body
            reportBody.innerHTML = '';

            let currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
                const row = document.createElement('tr');
                const dateCell = document.createElement('td');
                const taskCell = document.createElement('td');

                dateCell.textContent = formatDate(currentDate);
                
                const dayOfWeek = currentDate.getDay(); // 0 = Sunday, 6 = Saturday
                let defaultContent = defaultTask;
                let isWeekend = false;

                // Set the default task content
                if (dayOfWeek === 0) { // Sunday
                    defaultContent = 'SUNDAY';
                    taskCell.style.textAlign = 'center';
                    isWeekend = true;
                } else if (dayOfWeek === 6) { // Saturday
                    defaultContent = 'SATURDAY';
                    taskCell.style.textAlign = 'center';
                    isWeekend = true;
                }
                
                taskCell.textContent = defaultContent;
                taskCell.setAttribute('contenteditable', 'true');
                
                // Task Cell Event Listener for Empty Input (reverts to default text)
                taskCell.addEventListener('blur', (event) => {
                    const editedText = event.target.textContent.trim();
                    if (editedText === '') {
                        // Get the date string from the row's first cell (e.g., 08/01/2025)
                        const dateString = event.target.closest('tr').querySelector('td:first-child').textContent;
                        let taskDate = new Date(dateString); 
                        
                        // Re-apply timezone offset correction to ensure correct dayOfWeek calculation
                        taskDate.setMinutes(taskDate.getMinutes() + taskDate.getTimezoneOffset());

                        const taskDayOfWeek = taskDate.getDay();
                        let restoredContent = document.getElementById('default-task').value; // Get latest default task

                        if (taskDayOfWeek === 0) {
                            restoredContent = 'SUNDAY';
                        } else if (taskDayOfWeek === 6) {
                            restoredContent = 'SATURDAY';
                        }
                        
                        event.target.textContent = restoredContent;
                        // Re-align weekend text if it reverts to SUNDAY/SATURDAY
                        if (taskDayOfWeek === 0 || taskDayOfWeek === 6) {
                            event.target.style.textAlign = 'center';
                        } else {
                            event.target.style.textAlign = 'left';
                        }
                    } else if (isWeekend && (editedText === 'SUNDAY' || editedText === 'SATURDAY')) {
                           event.target.style.textAlign = 'center';
                    } else {
                        // Ensure edited text is left-aligned unless it's a weekend default
                        eventTarget.style.textAlign = 'left';
                    }
                });

                row.appendChild(dateCell);
                row.appendChild(taskCell);
                reportBody.appendChild(row);

                // Move to the next day
                currentDate.setDate(currentDate.getDate() + 1);
            }
        }

        // 4. Attach Event Listeners

        // Save data and regenerate report whenever an input value changes
        allInputs.forEach(input => {
            input.addEventListener('input', () => {
                saveFormData();
                generateReport();
            });
        });

        // Explicit button click listener
        generateBtn.addEventListener('click', generateReport);

        // Print button handler
        printBtn.addEventListener('click', () => {
            window.print();
        });

        // Clear data button handler
        clearBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all saved data?')) {
                clearSavedData();
                // Reset to default values
                allInputs.forEach(input => {
                    if (input.id === 'employee-name') input.value = 'JEREMY C. BENEDICTO';
                    else if (input.id === 'employee-position') input.value = 'JOB ORDER';
                    else if (input.id === 'department-name') input.value = 'HUMAN RESOURCE MANAGEMENT OFFICE';
                    else if (input.id === 'start-date') input.value = '2025-10-01';
                    else if (input.id === 'end-date') input.value = '2025-10-15';
                    else if (input.id === 'default-task') input.value = 'Continued system development for Municipal Digital Billboard';
                    else if (input.id === 'certifier-name') input.value = 'JENNELYN D. DALACAT';
                    else if (input.id === 'certifier-title') input.value = 'Head of HRMO';
                    else input.value = '';
                });
                generateReport();
            }
        });

        // Update modal event listeners
        closeUpdateModalBtn.addEventListener('click', hideUpdateModal);
        
        // Close modal when clicking outside
        updateModal.addEventListener('click', (e) => {
            if (e.target === updateModal) {
                hideUpdateModal();
            }
        });

        // Load saved data on page load and generate report
        window.addEventListener('load', () => {
            const hasSavedData = loadFormData();
            generateReport();
            
            // Show update modal
            showUpdateModal();
            
            // Show welcome message after a delay (after modal might be closed)
            setTimeout(() => {
                if (hasSavedData) {
                    showToast('Welcome back! Your previous data has been loaded.', 'success');
                }
            }, 2000);
        });
    </script>
</body>
</html>